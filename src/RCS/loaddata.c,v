head	1.3;
access;
symbols;
locks; strict;
comment	@ * @;


1.3
date	2002.07.03.07.50.09;	author tjaden;	state Exp;
branches;
next	1.2;

1.2
date	2002.01.24.07.23.01;	author tjaden;	state Exp;
branches;
next	1.1;

1.1
date	2002.01.12.20.16.35;	author tjaden;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Updated for new Store
@
text
@/* loaddata.c
 *
 * Peter Wang <tjaden@@users.sourceforge.net>
 */


#include <allegro.h>
#include "alloc.h"
#include "extdata.h"
#include "list.h"
#include "loaddata.h"
#include "path.h"
#include "store.h"


typedef struct file_list file_list_t;

struct file_list {
    file_list_t *next;
    file_list_t *prev;
    char *prefix;
    store_file_t handle;
};


/*------------------------------------------------------------*/


static list_head_t tiles_list;

int tiles_init (void)
{
    list_init (tiles_list);
    return 0;
}

int tiles_load (const char *filename, const char *prefix)
{
    file_list_t *f;
    store_file_t handle;
    
    handle = store_load_ex (filename, prefix, load_extended_datafile);
    if (!handle)
	return -1;

    f = alloc (sizeof *f);
    f->prefix = ustrdup (prefix);
    f->handle = handle;
    list_add (tiles_list, f);
    return 0;
}

void tiles_shutdown (void)
{
    file_list_t *f;

    list_for_each (f, &tiles_list) {
	free (f->prefix);
	store_unload (f->handle);
    }

    list_free (tiles_list, free);
}

void tiles_enumerate (void (*proc) (const char *prefix, store_file_t handle))
{
    file_list_t *f;

    list_for_each (f, &tiles_list)
	proc (f->prefix, f->handle);
}


/*------------------------------------------------------------*/


/* s/tiles/lights/g */

static list_head_t lights_list;

int lights_init (void)
{
    list_init (lights_list);
    return 0;
}

int lights_load (const char *filename, const char *prefix)
{
    file_list_t *f;
    store_file_t handle;
    
    handle = store_load_ex (filename, prefix, load_extended_datafile);
    if (!handle)
	return -1;

    f = alloc (sizeof *f);
    f->prefix = ustrdup (prefix);
    f->handle = handle;
    list_add (lights_list, f);
    return 0;
}

void lights_shutdown (void)
{
    file_list_t *f;

    list_for_each (f, &lights_list) {
	free (f->prefix);
	store_unload (f->handle);
    }

    list_free (lights_list, free);
}

void lights_enumerate (void (*proc) (const char *prefix, store_file_t handle))
{
    file_list_t *f;

    list_for_each (f, &lights_list)
	proc (f->prefix, f->handle);
}
@


1.2
log
@Changed all "()" declarations to "(void)".
@
text
@d22 1
a22 1
    int id;
d40 1
a40 1
    int id;
d42 2
a43 2
    id = store_load_ex (filename, prefix, load_extended_datafile);
    if (id < 0)
d48 1
a48 1
    f->id = id;
d59 1
a59 1
	store_unload (f->id);
d65 1
a65 1
void tiles_enumerate (void (*proc) (const char *prefix, int id))
d70 1
a70 1
	proc (f->prefix, f->id);
d90 1
a90 1
    int id;
d92 2
a93 2
    id = store_load_ex (filename, prefix, load_extended_datafile);
    if (id < 0)
d98 1
a98 1
    f->id = id;
d109 1
a109 1
	store_unload (f->id);
d115 1
a115 1
void lights_enumerate (void (*proc) (const char *prefix, int id))
d120 1
a120 1
	proc (f->prefix, f->id);
@


1.1
log
@Initial revision
@
text
@d31 1
a31 1
int tiles_init ()
d53 1
a53 1
void tiles_shutdown ()
d81 1
a81 1
int lights_init ()
d103 1
a103 1
void lights_shutdown ()
@
