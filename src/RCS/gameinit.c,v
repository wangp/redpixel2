head	1.10;
access;
symbols;
locks; strict;
comment	@ * @;


1.10
date	2002.07.11.12.27.15;	author tjaden;	state Exp;
branches;
next	1.9;

1.9
date	2002.07.11.12.25.08;	author tjaden;	state Exp;
branches;
next	1.8;

1.8
date	2002.07.10.10.10.04;	author tjaden;	state Exp;
branches;
next	1.7;

1.7
date	2002.02.16.14.15.20;	author tjaden;	state Exp;
branches;
next	1.6;

1.6
date	2002.02.11.03.55.52;	author tjaden;	state Exp;
branches;
next	1.5;

1.5
date	2002.01.29.14.52.40;	author tjaden;	state Exp;
branches;
next	1.4;

1.4
date	2002.01.26.11.55.02;	author tjaden;	state Exp;
branches;
next	1.3;

1.3
date	2002.01.24.07.23.01;	author tjaden;	state Exp;
branches;
next	1.2;

1.2
date	2002.01.18.14.30.59;	author tjaden;	state Exp;
branches;
next	1.1;

1.1
date	2002.01.12.20.16.35;	author tjaden;	state Exp;
branches;
next	;


desc
@@


1.10
log
@bindings.c deleted (stuff moved into mylua.c).
@
text
@/* gameinit.c - main init and shutdown
 *
 * Peter Wang <tjaden@@users.sourceforge.net>
 */


#include <allegro.h>
#include "libnet.h"
#include "bitmaskr.h"
#include "blod.h"
#include "explo.h"
#include "extdata.h"
#include "fastsqrt.h"
#include "gameinit.h"
#include "jpgalleg.h"
#include "loadaud.h"
#include "loaddata.h"
#include "magic4x4.h"
#include "mylua.h"
#include "object.h"
#include "objtypes.h"
#include "path.h"
#include "store.h"


void game_init (void)
{
    build_sqrt_table ();

    generate_magic_color_map ();
    generate_magic_conversion_tables ();
    
    register_bitmap_file_type ("jpg", load_jpg, NULL);
    register_extended_datafile ();
    register_aud_file_type ();

    path_init ();
    store_init (1024);
    bitmask_ref_init ();
 
    mylua_open ();

    tiles_init ();
    lights_init ();
    objtypes_init ();
    explosion_init ();

    object_init ();

    lua_dofile_path (the_lua_state, "init.lua");
    mylua_open_server_and_client_namespaces ();

    blod_init ();
    
    net_init ();
    net_loadconfig (NULL);
    net_detectdrivers (net_drivers_all);
    net_initdrivers (net_drivers_all);
}


void game_shutdown (void)
{
    net_shutdown ();

    blod_shutdown ();

    object_shutdown ();

    explosion_shutdown ();
    objtypes_shutdown ();
    lights_shutdown ();
    tiles_shutdown ();

    mylua_close ();

    bitmask_ref_shutdown ();
    store_shutdown ();
    path_shutdown ();

    free_magic_color_map ();
}
@


1.9
log
@Separated the one Lua state into two namespaces: server and client, so
that scripts run on the server don't have access to client-only
functions, and vice versa.  This makes things much less murky.
@
text
@a8 1
#include "bindings.h"
@


1.8
log
@Init store with size 1024 rather than 1023 (new store uses powers of two).
@
text
@a42 1
    bindings_init ();
d51 2
a52 1
    lua_dofile_path (lua_state, "init.lua");
a75 1
    bindings_shutdown ();
@


1.7
log
@Updated to Lua 4.1-work4.
@
text
@d39 1
a39 1
    store_init (1023);  /* (2^n)-1 or primes are supposed to be good */
@


1.6
log
@Bump up the size of store hash table.
@
text
@d42 1
a42 1
    mylua_open (0);
@


1.5
log
@Added loadaud support.
@
text
@d39 1
a39 1
    store_init (200);
@


1.4
log
@Added support for explosion graphics.
@
text
@d17 1
d36 1
@


1.3
log
@Changed all "()" declarations to "(void)".
@
text
@d12 1
d46 1
d69 1
@


1.2
log
@Added blods.
@
text
@d8 1
a8 1
#include <libnet.h>
d25 1
a25 1
void game_init ()
d59 1
a59 1
void game_shutdown ()
@


1.1
log
@Initial revision
@
text
@d11 1
d50 2
d62 2
@
