head	1.3;
access;
symbols;
locks; strict;
comment	@ * @;


1.3
date	2002.02.05.12.18.16;	author tjaden;	state Exp;
branches;
next	1.2;

1.2
date	2002.02.01.14.52.58;	author tjaden;	state Exp;
branches;
next	1.1;

1.1
date	2002.01.12.20.16.35;	author tjaden;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Use higher-precision timer under Windows (it was really bad before).
@
text
@/* timeval.c - struct timeval replacement for those without it
 *
 * Peter Wang <tjaden@@users.sourceforge.net>
 */


#include <time.h>
#include "timeval.h"


#ifdef TARGET_WINDOWS

#include <allegro.h>
#include <winalleg.h>

int gettimeofday (struct pwtimeval *tp, void *unused_tz)
{
    DWORD now = timeGetTime ();
    tp->tv_sec = now / 1000;
    tp->tv_usec = (now % 1000) * 1000;
    return 0;
}

void gettimeofday_init (void)
{
    timeBeginPeriod (1);
}

void gettimeofday_shutdown (void)
{
    timeEndPeriod (1);
}

#endif
@


1.2
log
@Updated mingw port.
@
text
@a2 3
 * This was adapted from lib/timeval.c from the Curl library.
 * The original copyright message is in the comment block below.
 * 
a5 15
/*
 * Copyright (C) 2000, Daniel Stenberg, <daniel@@haxx.se>, et al.
 *
 * In order to be useful for every potential user, curl and libcurl are
 * dual-licensed under the MPL and the MIT/X-derivate licenses.
 *
 * You may opt to use, copy, modify, merge, publish, distribute and/or sell
 * copies of the Software, and permit persons to whom the Software is
 * furnished to do so, under the terms of the MPL or the MIT/X-derivate
 * licenses. You may pick one of these licenses.
 *
 * This software is distributed on an "AS IS" basis, WITHOUT WARRANTY OF ANY
 * KIND, either express or implied.
 */

d18 14
a31 16
    SYSTEMTIME st;
    time_t tt;
    struct tm tmtm;
    /* mktime converts local to UTC */
    GetLocalTime (&st);
    tmtm.tm_sec = st.wSecond;
    tmtm.tm_min = st.wMinute;
    tmtm.tm_hour = st.wHour;
    tmtm.tm_mday = st.wDay;
    tmtm.tm_mon = st.wMonth - 1;
    tmtm.tm_year = st.wYear - 1900;
    tmtm.tm_isdst = -1;
    tt = mktime (&tmtm);
    tp->tv_sec = tt;
    tp->tv_usec = st.wMilliseconds * 1000;
    return 1;
@


1.1
log
@Initial revision
@
text
@d31 1
d34 1
a34 1
int gettimeofday (struct timeval *tp, void *unused_tz)
@
