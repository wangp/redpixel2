head	1.2;
access;
symbols;
locks; strict;
comment	@ * @;


1.2
date	2002.01.24.07.23.01;	author tjaden;	state Exp;
branches;
next	1.1;

1.1
date	2002.01.12.20.16.35;	author tjaden;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Changed all "()" declarations to "(void)".
@
text
@/* extdata.c
 *
 * Peter Wang <tjaden@@users.sourceforge.net>
 */


#include <allegro.h>
#include "bitmask.h"
#include "bitmaskg.h"
#include "extdata.h"
#include "magic4x4.h"


#define DAT_MAGK	DAT_ID ('M','A','G','K')
#define DAT_MASK	DAT_ID ('M','A','S','K')


static int property_exists (DATAFILE *d, int prop)
{
    return ustrcmp (get_datafile_property (d, prop), empty_string) != 0;
}


static void callback (DATAFILE *d)
{
    if (d->type == DAT_BITMAP) {
	if (property_exists (d, DAT_MASK)) {
	    BITMAP *old = d->dat;
	    d->dat = bitmask_create_from_bitmap (old);
	    d->type = DAT_MASK;
	    destroy_bitmap (old);
	}
	else if (!property_exists (d, DAT_MAGK)) {
	    BITMAP *old = d->dat;
	    d->dat = get_magic_bitmap_format (old, 0);
	    destroy_bitmap (old);
	}
    }
}


void register_extended_datafile (void)
{
    register_datafile_object (DAT_MASK, NULL, (void (*)(void *)) bitmask_destroy);
}


DATAFILE *load_extended_datafile (const char *filename)
{
    return load_datafile_callback (filename, callback);
}
@


1.1
log
@Initial revision
@
text
@d42 1
a42 1
void register_extended_datafile ()
@
